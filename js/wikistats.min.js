/*
wikistats.min.js

Copyright (c) 2012 Emw
Dual licensed under MIT and GPL licenses
*/
$(function(){var b={lines:{show:true},points:{show:true},xaxis:{mode:"time",timeformat:"%m/%d/%y",panRange:[null,null]},yaxis:{zoomRange:[0.1,null]},grid:{hoverable:true,clickable:true},zoom:{interactive:true},pan:{interactive:true}};browser_is_IE="false";browser_is_Chrome="false";if(navigator.appName=="Microsoft Internet Explorer"){browser_is_IE="true"}if(navigator.userAgent.search("Chrome")>-1){browser_is_Chrome="true"}var d=[];var f=$("#placeholder");$.plot(f,d,b);$("#go_button").click(function(){dataPoints="";var i=$(this);$("#notice").hide();if($("#p1").val().length==0){$("#link_span").remove();$("#notice").show();$("#notice").html("Please enter a Wikipedia article title (e.g., Haiku) into the 'Page' field and retry.");return}else{if($("#p1").val().match(/http\:\/\/.*/)){$("#link_span").remove();$("#notice").show();$("#notice").html("Please enter the article title's (e.g., Haiku), and not its URL.");return}else{$('<div id="interstitial_screen"></div>').insertAfter("#placeholder");$("#go_button").attr("disabled","disabled").css("color","gray");$("#link_span").remove();var h=setTimeout("$('#wait_notice').fadeIn(200, function(){$('#wait_notice').html('View data may take up to 30 seconds per page to retrieve.')});",4000)}}var k="";$.each($(".dataSeries"),function(l){if($(this).attr("name")!="to"){dataPoints+=$(this).attr("name")+"="+$(this).val();dataPoints+="&";if($(this).attr("name")=="project"){k=$(this).val()}}else{dataPoints+=$(this).attr("name")+"="+$(this).val()}});$.ajax({url:"get_traffic_data/",data:dataPoints,dataType:"json",method:"GET",success:g});function g(n){$("#link_span").remove();dataPoints_link=dataPoints.replace(/\s/g,"_");var p="http://emw.ath.cx/wikistats/?"+dataPoints_link+"&plot=1";var s="http://emw.ath.cx/rawdata/?"+dataPoints_link;var o="295px";var l=85;if(browser_is_Chrome=="true"){o="270px";l=95}if(browser_is_IE=="true"){l=68}if($("#notice").is(":hidden")){$('<span id="link_span" style="position:relative; top: 5px; margin-left:'+o+'"><a id="permalink" href="'+p+'">Link</a></span>').insertAfter("#notice");$('<a style="position:relative; left: 10px;" id="raw_data" href="'+s+'">Raw data</a>').insertAfter("#permalink");$("#permalink").click(function(u){u.preventDefault();$('<div id="dialog" title="Graph URL"><input type="text" size=60 value="'+p+'" /></div>').insertAfter("#header");$("#dialog").dialog({width:"auto",height:60,minHeight:60,position:[717,l],resizable:false})})}$("#interstitial_screen").remove();$("#go_button").removeAttr("disabled").css("color","black");num_of_nonpages=n.nonexistent_pages.length;if(num_of_nonpages>0){clearTimeout(h);$("#wait_notice").hide();nonpage_1=n.nonexistent_pages[0];$("#notice").show();if(num_of_nonpages==1){$("#notice").html("The article <a href='http://"+k+".wikipedia.org/wiki/"+nonpage_1+"'>"+nonpage_1+"</a> does not exist on English Wikipedia.")}else{if(num_of_nonpages==2){nonpage_2=n.nonexistent_pages[1];$("#notice").html("Neither <a href='http://"+k+".wikipedia.org/wiki/"+nonpage_1+"'>"+nonpage_1+"</a>  nor <a href='http://en.wikipedia.org/wiki/"+nonpage_2+"'>"+nonpage_2+"</a> exist as articles on English Wikipedia.")}else{if(num_of_nonpages==3){nonpage_2=n.nonexistent_pages[1];nonpage_3=n.nonexistent_pages[2];$("#notice").html("Neither <a href='http://"+k+".wikipedia.org/wiki/"+nonpage_1+"'>"+nonpage_1+"</a>, <a href='http://en.wikipedia.org/wiki/"+nonpage_2+"'>"+nonpage_2+"</a> nor <a href='http://en.wikipedia.org/wiki/"+nonpage_3+"'>"+nonpage_3+"</a> exist as articles on English Wikipedia. :-(")}}}if(!n.label_1){return}}clearTimeout(h);$("#wait_notice").hide();var q=$.plot(f,d,b);b.xaxis.panRange=[n.data_1[0][0],n.data_1[n.data_1.length-1][0]];b.xaxis.zoomRange=[null,(n.data_1[n.data_1.length-1][0]-n.data_1[0][0])];var t=function(){q.zoomOut();$("#placeholder").unbind("click",t)};$(window).keydown(function(u){if(u.shiftKey){$("#placeholder").bind("click",t)}});d=[];stats=[];$("#detail_panel").remove();page1_data={};page1_data.fromDate=n.fromDate;page1_data.toDate=n.toDate;page1_data.label="<a href='http://"+k+".wikipedia.org/wiki/"+n.label_1+"'>"+n.label_1+"</a>";page1_data.data=n.data_1;stats.page_1={};d.push(page1_data);page1_data.total_views=n.total_views_1;page1_data.page=n.label_1;stats.push(page1_data);if(n.label_2){page2_data={};page2_data.fromDate=n.fromDate;page2_data.toDate=n.toDate;page2_data.label="<a href='http://"+k+".wikipedia.org/wiki/"+n.label_2+"'>"+n.label_2+"</a>";page2_data.data=n.data_2;d.push(page2_data);page2_data.total_views=n.total_views_2;page2_data.page=n.label_2;stats.push(page2_data)}if(n.label_3){page3_data={};page3_data.fromDate=n.fromDate;page3_data.toDate=n.toDate;page3_data.label="<a href='http://"+k+".wikipedia.org/wiki/"+n.label_3+"'>"+n.label_3+"</a>";page3_data.data=n.data_3;d.push(page3_data);page3_data.total_views=n.total_views_3;page3_data.page=n.label_3;stats.push(page3_data)}var q=$.plot(f,d,b);if($(".legend table thead").length==0){$(".legend table").prepend('<thead><th></th><th>Page</th><th>Days</th><th>Views</th><th class="stat_head"><a href="http://en.wikipedia.org/wiki/Arithmetic_mean">Average</a></th><th class="stat_head"><a href="http://en.wikipedia.org/wiki/Standard_deviation">&sigma;</a></th></thead>');interpolation_flag=0;for(c=0;c<stats.length;c++){total=stats[c].total_views;sample_size=stats[c].data.length;mean=Math.round(total/sample_size);sd_numerator=0;if(mean>100){total=0;truncated_sample_size=0;for(j=0;j<sample_size;j++){this_datum=stats[c].data[j][1];if(this_datum>0){total+=this_datum;truncated_sample_size++}else{interpolation_flag=1}}mean=Math.round(total/sample_size);for(j=0;j<sample_size;j++){sd_numerator+=Math.pow((stats[c].data[j][1]-mean),2)}}else{for(j=0;j<sample_size;j++){sd_numerator+=Math.pow((page1_data.data[j][1]-mean),2)}}standard_deviation=Math.round(Math.pow(sd_numerator/sample_size,0.5));$(".legend table tbody tr:nth-child("+(c+1)+")").attr("id",stats[c].page+"_legend_row");$(".legend table tbody tr:nth-child("+(c+1)+")").append("<td class='ldata'>"+sample_size+"</td><td class='ldata'>"+total+"</td><td class='ldata mean'>"+mean+"</td><td class='ldata sd'>"+standard_deviation+"</td>");$("#info").show();if(interpolation_flag==1){if($(".th_starspan").length==0){$(".stat_head").append("<span class='th_starspan' style='color:red; padding-left:3px'>*</span>")}$("#cavaet").show()}else{$("#cavaet").hide()}}$(".legend table tr").click(function(){mean=this.cells.item(4).innerHTML;mean=mean.replace(/,/g,"");sd=this.cells.item(5).innerHTML;sd=sd.replace(/,/g,"");q.set_stat_summary(mean,sd)});$.each($(".ldata"),function(u,v){$(this).html(comma($(this).html()))})}function r(u,w,v){fadeTime=300;if(browser_is_IE=="true"){fadeTime=0}$('<div id="tooltip">'+v+"</div>").css({position:"absolute",display:"none",top:w+5,left:u+5,border:"1px solid #fdd",padding:"2px","background-color":"#fee",opacity:1}).appendTo("body").fadeIn(fadeTime)}var m=null;$("#placeholder").bind("plothover",function(w,A,v){$("#x").text(A.x.toFixed(2));$("#y").text(A.y.toFixed(2));if(v){if(m!=v.datapoint){m=v.datapoint;$("#tooltip").remove();var u=v.datapoint[0],z=v.datapoint[1].toFixed(0);date=new Date(u);r(v.pageX,v.pageY,"Views for "+v.series.label+" on "+(date.getUTCMonth()+1)+"/"+(date.getUTCDate())+"/"+date.getUTCFullYear()+": "+comma(z))}}else{$("#tooltip").remove();m=null}});c=0;$.each($(".legend").children(),function(u){if(c==0){$(this).hide()}c++});$(".legend table").attr("style","position: absolute; top: 7px; left: 710px; font-size: smaller; color: rgb(84, 84, 84);");$(".legend table").attr("cellspacing","0")}});var e;var a=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var c=0;c<a.length;c++){e=a[c].split("=");if(e[0]=="p1"&&e[1].match("_")){$("#p1").val(e[1].replace(/_/g," "))}if(e[0]=="p2"&&e[1].match("_")){$("#p2").val(e[1].replace(/_/g," "))}if(e[0]=="p3"&&e[1].match("_")){$("#p3").val(e[1].replace(/_/g," "))}if(e[0]=="from"){$("#from").val(e[1])}if(e[0]=="to"){$("#to").val(e[1])}if(e[0]=="plot"&&e[1]=="1"){$("#go_button").click();break}if(e[0]=="project"){$("option").each(function(){if($(this).attr("value")==e[1]){$(this).attr("selected","selected")}})}}});